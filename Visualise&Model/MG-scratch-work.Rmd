---
title: "R Notebook"
output:
  html_document:
    df_print: paged
  pdf_document: default
editor_options:
  chunk_output_type: inline
---
 

```{r}

knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(jsonlite)
library(httr)
library(rvest)
library(readxl)
library(tidyverse)
library(mdsr)   
library(tidyr)
library(ggplot2)
library(readr)
library(knitr)




#Total Trips Over Time
final_df %>% 
  group_by(year, transit_modes) %>% 
  summarise(sum_trips = sum(passenger_trips)) %>% 
  ggplot( aes(x = year, y = sum_trips/1000000000, color = transit_modes)) +geom_point() + labs(x= "Year", y= "Total Trips (in Billions)")

#gdp and percent workers commuting
df <- final_df %>% 
  filter(transit_modes == "Rail") %>% 
  mutate(log10_gdp= log10(gdp_msa))  %>% 
  mutate(log10_commuting = log10(percent_workers_commuting_by_public_transit_msa))



  ggplot(df, aes(x =log10_gdp, y = log10_commuting)) +geom_point(alpha= .8) + labs(x= "GDP by City (Log 10)", y = "Percent Workers Commuting via Public Transit") + geom_smooth(method = 'lm')

#percent commuting and trips ggplot
commuting_trips_model_df <- final_df %>% 
  mutate(passenger_trips = ifelse(passenger_trips==0, NA, passenger_trips)) %>% 
  mutate(percent_workers_commuting_by_public_transit_msa = ifelse(percent_workers_commuting_by_public_transit_msa==0, NA, percent_workers_commuting_by_public_transit_msa)) %>%
  mutate(log10_trips= log10(passenger_trips))  %>% 
  mutate(log10_commuting = log10(percent_workers_commuting_by_public_transit_msa))

commuting_trips_model <-lm(formula = log10_commuting~ log10_trips, data = commuting_trips_model_df)

ggplot(commuting_trips_model_df, aes(y = log10_commuting, x = log10_trips)) + geom_point(alpha= .2)+ labs(y= "log10(Percent Commuting)", x = "log10(Trips)") + geom_smooth(method = 'lm') + facet_grid(.~transit_modes)


#trips and gdp
trips_gdp_model_df <-final_df %>% 
  mutate(passenger_trips = ifelse(passenger_trips==0, NA, passenger_trips)) %>% 
  mutate(gdp_msa = ifelse(gdp_msa==0, NA, gdp_msa)) %>% 
  mutate(log10_trips= log10(passenger_trips))  %>% 
  mutate(log10_gdp = log10(gdp_msa)) 

trips_gdp_model <-lm(formula = log10_gdp ~ log10_trips, data = trips_gdp_model_df)

ggplot(trips_gdp_model_df, aes(x = log10_trips, y = log10_gdp)) + geom_jitter(alpha= .2)+ labs(x= "log10(Passenger Trips)", y = "log10(GDP)") + geom_smooth(method = 'lm', formula = y~x) 
```


```{r} 

#Funding and Trips ggplot
funding_trips_model_df <- final_df %>% 
  mutate(passenger_trips = ifelse(passenger_trips==0, NA, passenger_trips)) %>% 
  mutate(total_funding = ifelse(total_funding==0, NA, total_funding)) %>% 
  mutate(log10_trips= log10(passenger_trips))  %>% 
  mutate(log10_funding = log10(total_funding)) %>% 
  filter(transit_modes == "Non-Rail Bus")  

funding_trips_model <- lm(formula = log10_funding ~ log10_trips, data = funding_trips_model_df)

ggplot(df,aes(x = log10_trips, y = log10_funding)) + geom_jitter(alpha= .2)+ labs(x= "log10(Passenger Trips)", y = "log10(Total Funding)") + geom_smooth(method = 'lm', formula = y~x) 


```


